<div class="overflow-hidden">
    <div id="percelenManager" [ngClass]="{
        'translate-x-0': isOpen, 
        'translate-x-full': !isOpen
      }"
        class="percelenManager h-screen pt-24 px-5 text-center bg-gray-50 absolute right-0 top-0 z-40 w-1/4 transform transition-all duration-300 ease-in-out"
        [class.open]="isOpen">
        <img (click)="togglePanel()" class="absolute cursor-pointer -left-16 top-40" width="64" height="120"
            src="menubutton.svg" />
        <!-- <svg (click)="togglePanel()" width="32" height="70" xmlns="http://www.w3.org/2000/svg"
            class="absolute cursor-pointer -left-8 top-40">
            <rect x="5" y="5" width="32" height="60" fill="#f9fafb" rx="5" ry="5" />
        </svg> -->

        @if(!nieuwPerceel && !geselecteerdPerceel){
        <p class="text-green-800 text-2xl pb-4">Mijn percelen</p>
        <input type="text" class="w-full h-10 mb-4 p-2 border border-gray-300 rounded-md"
            placeholder="Zoek perceel op naam, gemeente of postcode" />
        <div class="h-96 overflow-y-auto">
            @for (perceel of userPercelen; track $index) {
            <app-perceelknop [perceel]="perceel" (click)="focusOnField(perceel.id)"></app-perceelknop>
            }
        </div>
        <div class="absolute bottom-4 left-1/2 -translate-x-1/2 w-full flex px-4 text-white">
            <button (click)="openPerceelToevoegen()" class="w-3/5 bg-green-600 h-12 rounded-md mr-4">
                <p>Voeg perceel toe</p>
            </button>
            <button class="w-3/5 bg-green-600 h-12 rounded-md">
                <p>Toegang beheren</p>
            </button>
        </div>
        }@else if ( geselecteerdPerceel ) {
        <div>
            <div>
                <p class="text-green-800 text-2xl pb-4">{{ geselecteerdPerceel.name }}</p>
                <button class="text-gray-600 hover:text-green-600 absolute right-8 top-24">
                    <svg width="15" height="15" fill="currentColor" class="bi bi-pencil-square" viewBox="0 0 16 16">
                        <path
                            d="M12.146 0l3.708 3.708a1 1 0 0 1 0 1.414L5.268 15.268a1 1 0 0 1-.57.268L0 15l.708-4.698a1 1 0 0 1 .268-.57L11.854 1a1 1 0 0 1 1.414 0z" />
                    </svg>
                </button>
                <button (click)="deleteUserField(geselecteerdPerceel.id)"
                    class="text-gray-600 hover:text-red-600 absolute right-2 top-24">
                    <svg width="15" height="15" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">
                        <path
                            d="M5.5 5.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-.5.5h-4a.5.5 0 0 1-.5-.5v-6zM4.118 4L4.83 3H11.17l.712 1H13a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V7a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h1.118zm3.682-1a1 1 0 0 0-.812.391L7 3H5.268a1 1 0 0 0-.812-.391H4.118zM5 12.5A1.5 1.5 0 0 0 6.5 14h3a1.5 1.5 0 0 0 1.5-1.5V7H5v5.5z" />
                    </svg>
                </button>
            </div>

            <div class="text-left">
                <label class="text-sm pb-2 ml-1">Naam</label>
                <p class="w-full h-10 mb-4 p-2 border border-gray-300 rounded-md flex items-center">
                    {{ geselecteerdPerceel.name }}
                </p>
                <label class="text-sm pb-2 ml-1">Oppervlakte in ha.</label>
                <p class="w-full h-10 mb-4 p-2 border border-gray-300 rounded-md flex items-center">
                    {{ geselecteerdPerceel.acreage }}
                </p>
                <label class="text-sm pb-2 ml-1">Gemeente</label>
                <p class="w-full h-10 mb-4 p-2 border border-gray-300 rounded-md flex items-center">
                    {{ geselecteerdPerceel.municipality }}
                </p>
                <label class="text-sm pb-2 ml-1">Postcode</label>
                <p class="w-full h-10 mb-4 p-2 border border-gray-300 rounded-md flex items-center">
                    {{ geselecteerdPerceel.postalcode }}
                </p>
            </div>

        </div>
        <div class="absolute bottom-4 left-1/2 -translate-x-1/2 w-full flex px-4 text-white">
            <button (click)="wisGeselecteerdPerceel()" class="w-3/5 bg-green-600 h-12 rounded-md mr-4">
                <p>Terug</p>
            </button>
            <button class="w-3/5 bg-green-600 h-12 rounded-md">
                <p>Schadeclaim maken</p>
            </button>
        </div>
        }
        @else {
        <p class="text-green-800 text-2xl pb-4">Nieuw perceel toevoegen</p>
        @if(geselecteerdNewPerceel){
        <form class="text-left">
            <label for="name" class="text-sm pb-2 ml-1">Naam</label>
            <input [(ngModel)]="geselecteerdNewPerceel.name" name="name" type="text"
                class="w-full h-10 mb-4 p-2 border border-gray-300 rounded-md" placeholder="Naam" />
            <label for="acreage" class="text-sm pb-2 ml-1">Oppervlakte in ha.</label>
            <input [(ngModel)]="geselecteerdNewPerceel.acreage" name="acreage" type="text"
                class="w-full h-10 mb-4 p-2 border border-gray-300 rounded-md" placeholder="Oppervlakte" />
            <label for="municipality" class="text-sm pb-2 ml-1">Gemeente</label>
            <input [(ngModel)]="geselecteerdNewPerceel.municipality" name="municipality" type="text"
                class="w-full h-10 mb-4 p-2 border border-gray-300 rounded-md" placeholder="Gemeente" />
            <label for="postalcode" class="text-sm pb-2 ml-1">Postcode</label>
            <input [(ngModel)]="geselecteerdNewPerceel.postalcode" name="postalcode" type="text"
                class="w-full h-10 mb-4 p-2 border border-gray-300 rounded-md" placeholder="Postcode" />
            <label for="crop" class="text-sm pb-2 ml-1">Gewas</label>
            <select name="crop" class="w-full h-10 mb-4 p-2 border border-gray-300 rounded-md bg-white">
                <option [value]="null" disabled selected>Selecteer een gewas</option>
                <option *ngFor="let crop of crops" [value]="crop.id">{{ crop.name }}</option>
            </select>
        </form>
        <p></p>
        } @else {
        <p>Selecteer een perceel door er op te klikken.</p>
        }
        <div class="absolute bottom-4 left-1/2 -translate-x-1/2 w-full flex px-4 text-white">
            <button [disabled]="geenPercelen" [ngClass]="{
                'bg-green-600': !geenPercelen, 
                'bg-gray-400': geenPercelen
              }" (click)="openPerceelToevoegen()" class="w-3/5 bg-green-600 h-12 rounded-md mr-4">
                <p>Terug</p>
            </button>
            <button [disabled]="!geselecteerdNewPerceel" [ngClass]="{
                'bg-green-600': geselecteerdNewPerceel, 
                'bg-gray-400': !geselecteerdNewPerceel
              }" class="w-3/5 bg-green-600 h-12 rounded-md"
                (click)="perceelLandbouwerToevoeging(userId, geselecteerdNewPerceel?.id)">
                <p>Toevoegen</p>
            </button>
        </div>
        }
    </div>
    @if(messageModal) {
    <div
        class="bg-white h-36 w-96 absolute left-1/2 -translate-x-1/2 top-1/2 -translate-y-1/2 z-50 rounded-md flex justify-center items-center border-4 border-green-600 shadow-lg">
        <button (click)="openModal()" class="absolute right-2 top-0 font-bold text-3xl text-green-600">Ã—</button>
        <div class="text-center">
            <p>Dit perceel is al toegewezen!</p>
            <p>Gelieve een ander perceel aan te duiden.</p>
        </div>
    </div>
    }
</div>
<div id="map" class="h-screen w-full z-30"></div>